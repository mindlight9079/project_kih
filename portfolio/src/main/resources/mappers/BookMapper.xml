<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.green.portfolio.dao.BookDAO">
	<select id="getBookList" resultType="kr.green.portfolio.vo.BookVO">
		select * from book
			<if test="cri.type==0">
				where (bk_isbn like concat('%',#{cri.search},'%')
				or bk_title like concat('%',#{cri.search},'%')
				or bk_subtitle like concat('%',#{cri.search},'%')
				or bk_au_writer like concat('%',#{cri.search},'%')
				or bk_publish like concat('%',#{cri.search},'%'))
			</if>
			<if test="cri.type==1">
				where (bk_title like concat('%',#{cri.search},'%')
				or bk_subtitle like concat('%',#{cri.search},'%'))
			</if>
			<if test="cri.type==2">
				where bk_au_writer like concat('%',#{cri.search},'%')
			</if>
			limit #{cri.pageStart}, #{cri.perPageNum}
	</select>
	<select id="getBook" resultType="kr.green.portfolio.vo.BookVO">
		select * from book where bk_isbn = #{bk_isbn}
	</select>
	<select id="getTotalCount" resultType="int">
		select count(*) from book
	</select>
	<insert id="getBookInfo" useGeneratedKeys="true" parameterType="kr.green.portfolio.vo.BookVO" keyProperty="bk_isbn">
		insert into book(bk_isbn, bk_title, bk_subtitle, bk_au_writer, bk_publish, bk_page, bk_publish_date, bk_mainImg, bk_pu_num)
			values(#{bk_isbn}, #{bk_title}, #{bk_subtitle}, #{bk_au_writer}, #{bk_publish}, #{bk_page}, #{bk_publish_date}, #{bk_mainImg}, #{bk_pu_num})
	</insert>
	<update id="updateBook">
		update book set 
			bk_isbn = #{bk_isbn},
			bk_title = #{bk_title},
			bk_subtitle= #{bk_subtitle},
			bk_au_writer= #{bk_au_writer},
			bk_publish = #{bk_publish},
			bk_mainImg = #{bk_mainImg},
			bk_page = #{bk_page},
			bk_publish_date = #{bk_publish_date},
			bk_pu_num = #{bk_pu_num}
				where bk_isbn = #{bk_isbn}
	</update>
</mapper>

